=== Расчеты показателей решения

[cols="2^8"]
|===

|Требование | расчет | Пояснение

|Низкая временная задержка при передаче тескового сообщения (менее 500 мс) 
|Среднее время: 300–400 мс
|Для 5000 DAU → ~1000 сообщений/мин → 16.7 сообщений/сек. Нагрузка не очень большая.

|Возможность загрузки медиаконтенда (в т.ч. документов, архивов) до 2 гигабайт - время загрузки до 15 минут
|2 ГБ за 15 мин = ~2.25 МБ/с
|Требуется высокая пропускная способность+rate limiter+балансировка нагрузки и возможно CDN.

|Задержка при передаче изображения < 1 сек
|Для изображений меняем разрешение перед сохранением, что не превышало 2048  - полагаем что средний максимальный размер изображения 5Мб - при требовании задержки при передаче изображения 1000 мс имеет необходимую скорость канала > 5 мб сек
|Требуется балансировка нагрузки/кеширование поулярных изображений (картинка в групповом чате)

|Воспроизведение видео < 1 сек после play
|Необходимо перекодировать видео в несколько битрейтов, которые дать возможность переключать пользователю, либо которые выбираются автоматически в зависимости от возможностей CDN И канала пользователя. Необходим стриминг с небольшим буфером на клиенте - заполняющийся по мере подгрузки видео. H.264 720p в 30 fps в стандарттном качестве использует примерно 4 Mbps
|Требуется использование h264 как изначально поддерживающего стриминг, возможно использование протокола quic/http3 для оптимального стриминга с низкой задержкой, балансировка + CDN

|Надежность 99.9 доступность, RPO 15 минут для истории прямых чатов, RPO 5 мин для истории групповых чатов. RPO 30 минут для медиа.
|99.9% = 8.76 часа в год сбоя |

|Требуется обеспечить хранение медиа | DAU(5000)*50Мб = 250Гигабайт Дискового пространства ежесуточно 91250Гб в год | 
|===


=== Компоненты влияющие на производительность

[cols="2^8"]
|===

|Компонент|влияние на производительность|Комментарий
|API Gateway|Высокое|Входная точка - должен обрабатывать самый большой поток запросов
|Сервис авторизации|Высокое|Требует высокой доступности
|Сервис чатов (директ/группы)|Высокое|Хранит и передаёт сообщения. Должен обрабатывать 100+ сообщений/сек.
|Сервис медиа (S3 + Redis)|Высокое|Обработка файлов до 2 ГБ — требует высокой пропускной способности.
|Kafka (брокер сообщений) Высокое|Асинхронная доставка уведомлений, межсервисное асинхронное взаимодейтствие, критичен для масштабируемости.
Redis-кэш|Высокое|Снижает нагрузку на S3 при публикации медиа. Но на занятии уточнили что редис это не то решение что подходит для медиа

