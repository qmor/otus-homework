=== Потоки данных и высокоуровневое взаимодействие

    1. Поток: Авторизация пользователя

    Направление: Клиент -> API Gateway -> Сервис авторизации -> Сервис пользователей -> Клиент
    Описание:
    Пользователь вводит учетные данные ->API Gateway направляет запрос на сервис авторизации ->Сервис проверяет данные в сервисе пользователей (через LDAP) ->Генерирует JWT-токен ->Отправляет его клиенту.
    Критичность: Высокая — без авторизации доступ невозможен.
    Технологии: HTTP, JWT, REST, LDAP (AD).

    2. Поток: Отправка сообщения (директ/группа)

    Направление: Клиент -> API Gateway -> Сервис чатов -> Kafka -> Сервис уведомлений -> Получатель
    Описание:
    Пользователь отправляет сообщение -> API Gateway маршрутизирует запрос -> Сервис чатов сохраняет сообщение в PostgreSQL -> Публикует событие в Kafka -> Сервис уведомлений получает событие -> Отправляет уведомление получателю (в реальном времени или при входе).
    Критичность: Высокая — основная функция мессенджера.
    Технологии: REST, Kafka, WebSocket, PostgreSQL.

    3. Поток: Доставка уведомлений (онлайн и офлайн)

    Направление: Сервис чатов ->Kafka ->Сервис уведомлений -> ->Клиент
    Описание:
    При новом сообщении сервис чатов публикует событие в Kafka ->Сервис уведомлений обрабатывает его ->Отправляет push-уведомление (если пользователь онлайн) или сохраняет в очередь (если офлайн - при этом этом при входе сообщения доставляются пользователю из этой очереди и по мере доставки выбрасываются из нее) ->При входе — доставляет уведомление.
    Критичность: Высокая — без уведомлений пользователь не знает о новых сообщениях.
    Технологии: HTTP, Kafka, Websocket, SMTP (почта), PostgreSQL.

    4. Поток: Загрузка и передача медиа

    Направление: Клиент ->API Gateway ->Сервис медиа ->S3 ->PostgreSQL ->Клиент
    Описание:
    Пользователь загружает фото/видео/документы ->API Gateway направляет запрос ->Сервис медиа сохраняет файл в minio ->Записывает метаданные (владелец, ссылка, тип) в PostgreSQL ->Отправляет ссылку в чат ->Получатель скачивает медиа через ссылку.
    Критичность: Средняя — нарушение не блокирует общение, но снижает UX.
    Технологии: REST, S3, PostgreSQL, Redis.

    5. Поток: Поиск по истории чатов

    Направление: Клиент ->API Gateway ->Сервис поиска ->Elasticsearch ->Клиент
    Описание:
    Пользователь вводит запрос ->API Gateway направляет его на сервис поиска ->Сервис ищет по индексу в Elasticsearch ->Возвращает результаты (с текстом, датой, участниками).
    Критичность: Средняя — важен для продуктивности, но не критичен для основного функционала.
    Технологии: REST, Elasticsearch, PostgreSQL (для метаданных).

    6. Поток: Управление пользователями (блокировка, удаление)

    Направление: Администратор ->API Gateway ->Сервис авторизации ->Сервис пользователей ->Сервис чатов ->Kafka ->Сервис уведомлений
    Описание:
    Администратор блокирует пользователя ->Сервис авторизации обновляет статус в сервисе пользователей ->Сервис чатов удаляет доступ ->Публикует событие в Kafka ->Сервис уведомлений отправляет уведомление о блокировке.
    Также может быть реализовано глобальное удаление сообщений — через сервис чатов.
    Критичность: Высокая — влияет на безопасность и контроль доступа.
    Технологии: REST, Kafka, PostgreSQL.

    7. Поток: Двухфакторная аутентификация (OTP)

    Направление: Клиент ->Сервис авторизации ->Сервис уведомлений ->Mail-сервер ->Клиент
    Описание:
    При входе с OTP ->Сервис авторизации генерирует код ->Отправляет его через сервис уведомлений ->Сервис уведомлений пересылает на почту ->Пользователь вводит код ->Аутентификация проходит.
    Критичность: Высокая — ключевая часть безопасности.
    Технологии: REST, SMTP, Kafka, PostgreSQL.